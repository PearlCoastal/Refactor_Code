
# 6.10 å‡½æ•°ç»„åˆæˆå˜æ¢

![](../img/6.10.jpg)

## ä½¿ç”¨åœºæ™¯

- å¦‚æœä¿®æ”¹äº†ä¸€é¡¹æ•°æ®çš„å€¼ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- å»ºè®®ä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»æ–¹æ³•

### é‡æ„å‰

```java
reading = {customer : "ivan", quantity : 10, month : 5, year : 2017};
```

- `client 1`
æ”¶å–åŸºæœ¬è´¹ç”¨

```java
const aReading = acquireReading();
const baseCharge = baseRate(aReading.month, aReading.year)aReading.quantity;
```

- `client 2`
åŸºæœ¬è´¹ç”¨ + è¶…å‡ºåŸºæœ¬è´¹ç”¨çš„éƒ¨åˆ†è¦äº¤ç¨

```java
const aReading = acquireReading();
const base = (baseRate(aReading.month, aReading.year)aReading.quantity);
const taxableCharge = Math.max(0, base - taxThreshold(aReading.year));
```

- `client 3`
æç‚¼è®¡ç®—åŸºæœ¬è´¹ç”¨çš„å‡½æ•°

```java
const aReading = acquireReading();
const basicChargeAmount = calculateBaseCharge(aReading);
function calculateBaseCharge(aReading)
{
    return baseRate(aReading.month, aReading.year)aReading.quantity;
}
```

### STEP1. åˆ›å»ºä¸€ä¸ªå˜æ¢å‡½æ•°ï¼šå¤åˆ¶è¾“å…¥çš„å¯¹è±¡

```java
function enrichReading(original)
{
    const result = _.cloneDeep(original);
    return result;
}
```

### STEP2. å°† `calculateBaseCharge()` æ¬ç§»åˆ°å˜æ¢å‡½æ•°ä¸­

```java
function enrichReading(original)
{
    const result = _.cloneDeep(original);
    result.baseCharge = calculateBaseCharge(result);
    return result;
}
function calculateBaseCharge(aReading)
{
    return baseRate(aReading.month, aReading.year)aReading.quantity;
}
```

- ä¿®æ”¹ `client 3`ï¼Œè®©ä»–ä½¿ç”¨å¢å¼ºåçš„ `areading` å­—æ®µ

```java
const rawReading = acquireReading();
const aReading = enrichReading(rawReading);
const basicChargeAmount = aReading.baseCharge;
```

- ä¿®æ”¹ `client 1`

```java
const rawReading = acquireReading();
const aReading = enrichReading(rawReading); // aReading çš„å‘½å = accumulationg variableï¼Œç´¯è®¡å˜é‡ï¼Œå½“æ›´å¤šçš„é€»è¾‘æ¬ç§»åˆ°å˜æ¢å‡½æ•°ä¸­
const baseCharge = aReading.baseCharge;     // è€ƒè™‘ä½¿ç”¨å†…è”å˜é‡å»æ‰baseCharge
```

### STEP3. ä¿®æ”¹è®¡ç®—åº”ç¨è´¹ç”¨çš„é€»è¾‘

```java
const rawReading = acquireReading();
const aReading = enrichReading(rawReading);
const base = aReading.baseCharge;
const taxableCharge = Math.max(0, base - taxThreshold(aReading.year));
```

- ç”¨å†…è”å˜é‡å»æ‰ `base` å˜é‡

```java
const rawReading = acquireReading();
const aReading = enrichReading(rawReading);
const taxableCharge = Math.max(0, aReading.baseCharge - taxThreshold(aReading.year));
```

- å°† `taxableCharge` å‡½æ•°æ¬åˆ°å˜æ¢å‡½æ•°å†…

```java
function enrichReading(original)
{
    const result = _.cloneDeep(original);
    result.baseCharge = calculateBaseCharge(result);
    result.taxableCharge = Math.max(0, result.baseCharge - taxThreshold(result.year));
    return result;
}
```

### STEP4. å°†è®¡ç®—ç¨çš„é€»è¾‘æ¬ç§»åˆ°å˜æ¢å‡½æ•°ä¸­

- ä¿®æ”¹ `client 2`ï¼Œè®©ä»–ä½¿ç”¨æ–°æ·»çš„å­—æ®µ

```java
const rawReading = acquireReading();
const aReading = enrichReading(rawReading);
const taxableCharge = aReading.taxableCharge; // ä½¿ç”¨å˜æ¢å‡½æ•°çš„ç´¯è®¡å­—æ®µçš„å¢å¼ºåŠŸèƒ½

function enrichReading(original)
{
    const result = _.cloneDeep(original);
    result.baseCharge = calculateBaseCharge(result);
    result.taxableCharge = Math.max(0, result.baseCharge - taxThreshold(result.year)); // NOTE: æ¬è¿åˆ°å˜æ¢å‡½æ•°ä¸­
    return result;
}
```

### STEP5. ä½¿ç”¨å†…è”å˜é‡å°†taxableChargeå˜é‡å»æ‰

```java
const rawReading = acquireReading();
const aReading = enrichReading(rawReading);
// const taxableCharge = aReading.taxableCharge;
```

### é‡æ„å

```java
function enrichReading(original)
{
    const result = _.cloneDeep(original);
    result.baseCharge = calculateBaseCharge(result);
    result.taxableCharge = Math.max(0, result.baseCharge - taxThreshold(result.year));
    return result;
}

// client 1
const rawReading = acquireReading();
const aReading = enrichReading(rawReading); // aReading çš„å‘½å = accumulationg variableï¼Œç´¯è®¡å˜é‡ï¼Œå½“æ›´å¤šçš„é€»è¾‘æ¬ç§»åˆ°å˜æ¢å‡½æ•°ä¸­

// client 3
const rawReading = acquireReading();
const aReading = enrichReading(rawReading);
```

## é‡æ„å®ŒæˆğŸ€
