
# 6.9 å‡½æ•°ç»„åˆæˆç±»

![](../img/6.9.jpg)

## ä½¿ç”¨åœºæ™¯

-å¦‚æœä¸€ç»„å‡½æ•°å½¢å½±ä¸ç¦»çš„æ“ä½œåŒä¸€å—æ•°æ®ï¼Œå°±å¯ä»¥å°†å‡½æ•°+æ•°æ®æ†ç»‘åˆ°åŒä¸€ä¸ªç±»ä¸­

### é‡æ„å‰

```java
reading = {customer : "ivan", quantity : 10, month : 5, year : 2017};
```

- client 1 æ”¶å–åŸºæœ¬è´¹ç”¨

```java
const aReading = acquireReading();
const baseCharge = baseRate(aReading.month, aReading.year)aReading.quantity;
```

- client 2 åŸºæœ¬è´¹ç”¨ + è¶…å‡ºåŸºæœ¬è´¹ç”¨çš„éƒ¨åˆ†è¦äº¤ç¨

```java
const aReading = acquireReading();
const base = (baseRate(aReading.month, aReading.year)aReading.quantity);
const taxableCharge = Math.max(0, base - taxThreshold(aReading.year));
```

- client 3 æç‚¼è®¡ç®—åŸºæœ¬è´¹ç”¨çš„å‡½æ•°

```java
const aReading = acquireReading();
const basicChargeAmount = calculateBaseCharge(aReading);
function calculateBaseCharge(aReading)
{
    return baseRate(aReading.month, aReading.year)aReading.quantity;
}
```

### STEP1. å°è£…è®°å½•å°†è®°å½•å˜æˆç±»

```java
class Reading
{
    constructor(data)
    {
        this._customer = data.customer;
        this._quantity = data.quantity;
        this._month = data.month;
        this._year = data.year;
    }
    get customer() { return this._customer; }
    get quantity() { return this._quantity; }
    get month() { return this._month; }
    get year() { return this._year; }
}
```

### STEP2. ç”¨æ¬ç§»å‡½æ•°å°† calculateBaseCharge æ¬åˆ°æ–°ç±»ä¸­

```java
get calculateBaseCharge()
{
    return baseRate(this.month, this.year)this.quantity;
}

// å‡½æ•°æ”¹åï¼ŒæŒ‰ç…§å–œæ¬¢çš„é£æ ¼æ”¹å
get baseCharge()
{
    return baseRate(this.month, this.year)this.quantity;
}

// æ­¤æ—¶çš„ client 3
const rawReading = acquireReading();
const aReading = new Reading(rawReading);
const basicChargeAmount = aReading.baseCharge;

// client 1
const rawReading = acquireReading();
const aReading = new Reading(rawReading);
const baseCharge = aReading.baseCharge;

// client 2
const rawReading = acquireReading();
const aReading = new Reading(rawReading);
const taxableCharge = Math.max(0, aReading.baseCharge - taxThreshold(aReading.year));
```

### STEP3. ç”¨æç‚¼å‡½æ•°å°†taxablechargeçš„é€»è¾‘æç‚¼æˆå‡½æ•°

```java
function taxableChargeFn(aReading)
{
    return Math.max(0, aReading.baseCharge - taxThreshold(aReading.year));
}

// æ¬ç§»å‡½æ•°æ¬åˆ°Readingç±»ä¸­
get taxableCharge()
{
    return Math.max(0, this.baseCharge - taxThreshold(this.year));
}

// client3
const rawReading = acquireReading();
const aReading = new Reading(rawReading);
const taxableCharge = aReading.taxableCharge;
```

### é‡æ„å

```java
class Reading
{
    constructor(data)
    {
        this._customer = data.customer;
        this._quantity = data.quantity;
        this._month = data.month;
        this._year = data.year;
    }
    get customer() { return this._customer; }
    get quantity() { return this._quantity; }
    get month() { return this._month; }
    get year() { return this._year; }
 
    get baseCharge()
    {
        return baseRate(this.month, this.year)this.quantity;
    }
    get taxableCharge()
    {
        return Math.max(0, this.baseCharge - taxThreshold(this.year));
    }

    // client 1
    const rawReading = acquireReading();
    const aReading = new Reading(rawReading);
    const baseCharge = aReading.baseCharge;

    // client 2
    const rawReading = acquireReading();
    const aReading = new Reading(rawReading);
    const taxableCharge = aReading.taxableCharge;

    // client3
    const rawReading = acquireReading();
    const aReading = new Reading(rawReading);
    const taxableCharge = aReading.taxableCharge;
}
```

## é‡æ„å®ŒæˆğŸ€
