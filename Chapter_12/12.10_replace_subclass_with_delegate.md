# 12.10 ä»¥å§”æ‰˜å–ä»£å­ç±»

![](../img/12.10.jpg)

## ä½¿ç”¨åœºæ™¯

- ç»§æ‰¿ç»™ç±»ä¹‹é—´å¼•å…¥äº†éå¸¸ç´§å¯†çš„å…³ç³»ï¼Œåœ¨è¶…ç±»ä¸Šåšä»»ä½•ä¿®æ”¹ï¼Œéƒ½å¾ˆå¯èƒ½ç ´åå­ç±»ï¼Œç”¨å§”æ‰˜~

- å¯¹è±¡ç»„åˆä¼˜äºç±»ç»§æ‰¿

- å§”æ‰˜å’Œç»„åˆæ˜¯ä¸€å›äº‹

- @Date: 2023-04-23 16:25:29

### é‡æ„å‰

```java
class Booking
{
    constructor(show, date)
    {
        this._show = show;
        this._date = date;
    }

    // å¸¸è§„ç¥¨åœ¨æ¼”å‡ºç»“æŸåä¼šæœ‰å¯¹è¯åˆ›ä½œè€…çš„ç¯èŠ‚ï¼Œä½†ä»…ä»…æ˜¯åœ¨éé«˜å³°æ—¥
    get hasTalkback()
    {
        return this._show.hasOwnProperty('talkback') && !this.isPeakDay;
    }

    // å®šä»·é€»è¾‘
    get basePrice()
    {
        let result = this._show.price;
        if (this.isPeakDay)
            result += Math.round(result * 0.15);
        return result;
    }
}

class PremiumBooking extends Booking
{
    constructor(show, date, extras)
    {
        super(show, date);
        this._extras = extras;
    }

    // å¤å†™äº†è¿™ä¸ªé€»è¾‘ï¼Œä»»ä½•ä¸€å¤©éƒ½å¯ä»¥talkback
    get hasTalkback()
    {
        return this._show.hasOwnProperty('talkback');
    }

    // å®šä»·é€»è¾‘ï¼Œè°ƒç”¨äº†è¶…ç±»ä¸­çš„æ–¹æ³•
    get basePrice()
    {
        return Math.round(super.basePrice + this._extras.premiumFee);
    }

    // å®šä¹‰äº†ä¸€ä¸ªè¶…ç±»ä¸­æ²¡æœ‰çš„è¡Œä¸º
    get hasDinner()
    {
        return this._extras.hasOwnProperty('dinner') && !this.isPeakDay;
    }
}
```

- client

```java
aBooking = new Booking(show, date);

aBooking = new PremiumBooking(show, date, extras);
```

### STEP1. å…ˆç”¨å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•°ï¼ŒæŠŠæ„é€ å‡½æ•°å°è£…èµ·æ¥

```java
function createBooking(show, date)
{
    return new Booking(show, date);
}
function createPremiumBooking(show, date, extras)
{
    return new PremiumBooking(show, date, extras);
}
```

- client

```java
aBooking = createBooking(show, date);

aBooking = createPremiumBooking(show, data, extras);
```

### STEP2. æ–°å»ºä¸€ä¸ªå§”æ‰˜ç±»

- æ„é€ å‚æ•°ç”±ä¸¤éƒ¨åˆ†ï¼š

- 1. æŒ‡å‘ `Booking` å¯¹è±¡çš„åå‘å¼•ç”¨

- 2. åªæœ‰å­ç±»æ‰éœ€è¦çš„æ•°æ®

```java
class PremiumBookingDelegate
{
    constructor(hostBooking, extras)
    {
        this._host = hostBooking;   // æŒ‡å‘ Booking å¯¹è±¡çš„åå‘å¼•ç”¨
        this._extras = extras;      // åªæœ‰å­ç±»éœ€è¦çš„æ•°æ®
    }
}
```

### STEP3. å°†æ–°å»ºçš„å§”æ‰˜å¯¹è±¡ä¸ `Booking` å¯¹è±¡å…³è”èµ·æ¥

```java
function createPremiumBooking(show, date, extras)
{
    const result = new PremiumBooking(show, date, extras);
    result._bePremium(extras);
    return result;
}

class Booking
{
    _bePremium(extras)
    {
        this._premiumDelegate = new PremiumBookingDelegate(this, extras);
    }
}
```

### STEP4. ç»“æ„è®¾ç½®å¥½äº†ï¼Œå¼€å§‹åŠ¨æ‰‹æ¬ç§»

- hasTalkback æŠŠå­ç±»çš„å‡½æ•°æ¬åˆ°å§”æ‰˜ç±»ä¸­

```java
class PremiumBookingDelegate
{
    get hasTalkback()
    {
        return this._host._show.hasOwnProperty('talkback');
    }
}

class PremiumBooking
{
    // ç¡®ä¿æ­£å¸¸ååˆ æ‰å­ç±»ä¸­çš„å‡½æ•°
    // get hasTalkback()
    // {
    //     return this._premiumDelegate.hasTalkback;
    // }
}

class Booking
{
    get hasTalkback()
    {
        return (this._premiumDelegate)
                   ? this._premiumDelegate.hasTalkback
                   : this._show.hasOwnProperty('talkback') && !this.isPeakDay;
    }
}
```

### STEP5. æ¬ç§» `basePrice` å‡½æ•°

```java
class PremiumBooking
{
    // å­ç±»ä¸­è°ƒç”¨äº†è¶…ç±»ä¸­çš„åŒåå‡½æ•°
    get basePrice()
    {
        return Math.round(super.basePrice + this._extras.premiumFee);
    }
}
```

- å¯ä»¥é‡æ–°å®šä¹‰å§”æ‰˜å¯¹è±¡ä¸­çš„å‡½æ•°ï¼Œä½¿å…¶æˆä¸ºåŸºç¡€å‡½æ•°çš„æ‰©å±•

```java
class Booking
{
    get basePrice()
    {
        let result = this._show.price;
        if (this.isPeakDay)
            result += Math.round(result * 0.15);
        return (this._premiumDelegate)
                   ? this._premiumDelegate.extendBasePrice(result)
                   : result;
    }
}

class PremiumBookingDelegate
{
    extendBasePrice(base)
    {
        return Math.round(base + this._extras.premiumFee);
    }
}
```

### STEP6. æ¬ç§»æœ€åä¸€ä¸ªåªå­˜åœ¨äºå­ç±»ä¸­çš„å‡½æ•°

```java
class PremiumBooking
{
    get hasDinner()
    {
        return this._extras.hasOwnProperty('dinner') && !this.isPeakDay;
    }
}

class PremiumBookingDelegate
{
    get hasDinner()
    {
        return this._extras.hasOwnProperty('dinner') && !this._host.isPeakDay;
    }
}
```

- ç„¶ååœ¨ `Booking` ä¸­æ·»åŠ åˆ†å‘é€»è¾‘

```java
class Booking
{
    get hasDinner()
    {
        return (this._premiumDelegate)
                   ? this._premiumDelegate.hasDinner
                   : undefined;
    }
}
```

### STEP7. æµ‹è¯•æ²¡æœ‰é—®é¢˜ï¼Œåˆ æ‰å­ç±»

```java
function createPremiumBooking(show, date, extras)
{
    const result = new PremiumBooking(show, date, extras);
    result._bePremium(extras);
    return result;
}
// class PremiumBooking extends Booking ...
```

### é‡æ„å

- é¡¶å±‚ä½œç”¨åŸŸ

```java
function createPremiumBooking(show, date, extras)
{
    const result = new PremiumBooking(show, date, extras);
    result._bePremium(extras);
    return result;
}

class PremiumBookingDelegate
{
    constructor(hostBooking, extras)
    {
        this._host = hostBooking;
        this._extras = extras;
    }
    get hasTalkback()
    {
        return this._host._show.hasOwnProperty('talkback');
    }

    extendBasePrice(base)
    {
        return Math.round(base + this._extras.premiumFee);
    }

    get hasDinner()
    {
        return this._extras.hasOwnProperty('dinner') && !this._host.isPeakDay;
    }
}

class Booking
{
    constructor(show, date)
    {
        this._show = show;
        this._date = date;
    }
    _bePremium(extras)
    {
        this._premiumDelegate = new PremiumBookingDelegate(this, extras);
    }
    get hasTalkback()
    {
        return (this._premiumDelegate)
                   ? this._premiumDelegate.hasTalkback
                   : this._show.hasOwnProperty('talkback') && !this.isPeakDay;
    }
    get basePrice()
    {
        let result = this._show.price;
        if (this.isPeakDay)
            result += Math.round(result * 0.15);
        return (this._premiumDelegate)
                   ? this._premiumDelegate.extendBasePrice(result)
                   : result;
    }
    get hasDinner()
    {
        return (this._premiumDelegate)
                   ? this._premiumDelegate.hasDinner
                   : undefined;
    }
}
```

## é‡æ„å®ŒæˆğŸ€
