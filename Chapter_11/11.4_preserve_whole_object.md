<!--
 * @Author: FEIFEI SUN
 * @Description: 
 * @Detail: 
 * @Date: 2023-04-28 10:09:35
 * 
-->
# 11.4 ä¿æŒå¯¹è±¡å®Œæ•´

![](../img/11.4.jpg)

## ä½¿ç”¨åœºæ™¯

- å¦‚æžœä¸€ä¸²ä»£ç ä»Žä¸€ä¸ªè®°å½•ç»“æž„ä¸­å¯¼å‡ºå‡ ä¸ªå€¼ï¼Œç„¶åŽåˆæŠŠè¿™å‡ ä¸ªå€¼ä¸€èµ·ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ï¼šç›´æŽ¥å°†æ•´ä¸ªè®°å½•ä¼ ç»™è¿™ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä½“å†…éƒ¨å¯¼å‡ºæ‰€éœ€çš„å€¼ã€‚

## ç¤ºä¾‹ 1. ç›´æŽ¥ç¼–å†™æ–°å‡½æ•°

### é‡æž„å‰

- è°ƒç”¨æ–¹

```java
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (!aPlan.withinRange(low, high))
    alerts.push("room temperature went outside range");
```

- å‡½æ•°ä½“

```java
class HeatingPlan
{
    withinRange(bottom, top)
    {
        return (bottom >= this._temperatureRange.low) && (top <= this._temperatureRange.high);
    }   
}
```

- å…¶å®žä¸å¿…å°†æ¸©åº¦èŒƒå›´çš„ä¿¡æ¯æ‹†å¼€å•ç‹¬ä¼ é€’ï¼Œå¯ä»¥å°†æ•´ä¸ªèŒƒå›´å¯¹è±¡ä¼ é€’ç»™ withinRange å‡½æ•°

### STEP1. åœ¨ `HeatingPlan` ç±»ä¸­æ–°å¢žä¸€ä¸ªç©ºå‡½æ•°ï¼Œè®¾ç½®åˆé€‚çš„å‚æ•°åˆ—è¡¨ï¼Œå¹¶åœ¨å‡½æ•°ä½“å†…è°ƒç”¨çŽ°æœ‰çš„ `withinRange` å‡½æ•°

```java
class HeatingPlan
{
    withinRange(bottom, top)
    {
        return (bottom >= this._temperatureRange.low) && (top <= this._temperatureRange.high);
    }
    xxNEWwithinRange(aNumberRange)
    {
        return this.withinRange(aNumberRange.low, aNumberRange.high);
    }
}
```

### STEP2. æ‰¾åˆ°è°ƒç”¨çŽ°æœ‰å‡½æ•°çš„åœ°æ–¹ï¼Œå°†å…¶æ”¹ä¸ºè°ƒç”¨æ–°å‡½æ•°

- è°ƒç”¨æ–¹

```java
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
// æ›¿æ¢æˆæ–°å‡½æ•°
if (!aPlan.xxNEWwithinRange(aRoom.daysTempRange))
    alerts.push("room temperature went outside range");
```

- ä¿®æ”¹è°ƒç”¨å¤„æ—¶ï¼Œåˆ©ç”¨ [8.9 ç§»é™¤æ­»ä»£ç ](../Chapter_8/8.9_remove_dead_code.md) å°†ä¸å†éœ€è¦çš„ä»£ç ç§»é™¤

```java
// const low = aRoom.daysTempRange.low;
// const high = aRoom.daysTempRange.high;

if (!aPlan.xxNEWwithinRange(aRoom.daysTempRange))
    alerts.push("room temperature went outside range");
```

### STEP3. åˆ©ç”¨ [6.2 å†…è”å‡½æ•°](../Chapter_6/6.2_inline_function.md) å°†æ—§å‡½æ•°å†…è”åˆ°æ–°å‡½æ•°ä½“å†…

```java
class HeatingPlan
{
    // withinRange(bottom, top)
    // {
    //     return (bottom >= this._temperatureRange.low) && (top <= this._temperatureRange.high);
    // }
    xxNEWwithinRange(aNumberRange)
    {
        return (aNumberRange.bottom >= this._temperatureRange.low) && (aNumberRange.top <= this._temperatureRange.high);
    }
}
```

### é‡æž„åŽ

```java
class HeatingPlan
{
    withinRange(aNumberRange)
    {
        return (aNumberRange.bottom >= this._temperatureRange.low) && (aNumberRange.top <= this._temperatureRange.high);
    }
}
```

- è°ƒç”¨æ–¹

```java
if (!aPlan.xxNEWwithinRange(aRoom.daysTempRange))
    alerts.push("room temperature went outside range");
```

## ç¤ºä¾‹ 2. æ¢ä¸ªæ–¹å¼åˆ›å»ºæ–°å‡½æ•°

### é‡æž„å‰

- è°ƒç”¨æ–¹

```java
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (!aPlan.withinRange(low, high))
    alerts.push("room temperature went outside range");
```

### STEP1. å…ˆæ•´ç†ä»£ç ï¼Œä»¥ä¾¿ç”¨ [6.1 æç‚¼å‡½æ•°](../Chapter_6/6.1_extract_function.md) æ¥åˆ›å»ºæ–°å˜é‡

- è°ƒç”¨æ–¹

```java
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
const isWithinRange = aPlan.withinRange(low, high);
if (!isWithinRange)
    alerts.push("room temperature went outside range");
```

### STEP2. å°†è¾“å…¥å‚æ•°ä¹Ÿæç‚¼å‡ºæ¥

- è°ƒç”¨æ–¹

```java
const tempRange = aRoom.daysTempRange;
const low = tempRange.low;
const high = tempRange.high;
const isWithinRange = aPlan.withinRange(low, high);
if (!isWithinRange)
    alerts.push("room temperature went outside range");
```

### STEP3. åˆ©ç”¨ [6.1 æç‚¼å‡½æ•°](../Chapter_6/6.1_extract_function.md) æ¥åˆ›å»ºæ–°å‡½æ•°

- è°ƒç”¨æ–¹

```java
const tempRange = aRoom.daysTempRange;
const isWithinRange = xxNEWwithinRange(aPlan, tempRange);
if (!isWithinRange)
    alerts.push("room temperature went outside range"); 
```

- é¡¶å±‚ä½œç”¨åŸŸ

```java
function xxNEWwithinRange(aPlan, tempRange)
{
    const low = tempRange.low;
    const high = tempRange.high;
    const isWithinRange = aPlan.withinRange(low, high);
    return isWithinRange;
}
```

### STEP4. ç”±äºŽæ—§å‡½æ•°å±žäºŽå¦ä¸€ä¸ªä¸Šä¸‹æ–‡ `class HeatingPlan`ï¼Œ åˆ©ç”¨ [8.3 æ¬ç§»å‡½æ•°](../Chapter_8/8.3_move_statements_into_function.md) æŠŠæ–°å‡½æ•°ä¹Ÿæ¬è¿‡åŽ»

- è°ƒç”¨æ–¹

```java
const tempRange = aRoom.daysTempRange;
const isWithinRange = aPlan.xxNEWwithinRange(tempRange);
if (!isWithinRange)
    alerts.push("room temperature went outside range");
```

```java
class HeatingPlan
{
    xxNEWwithinRange(tempRange)
    {
        const low = tempRange.low;
        const high = tempRange.high;
        const isWithinRange = this.withinRange(low, high);
        return isWithinRange;
    }
}
```

### STEP5. æ›¿æ¢å…¶ä»–è°ƒç”¨è€…ï¼Œå°†æ—§å‡½æ•°å†…æ•›åˆ°æ–°å‡½æ•°

## é‡æž„å®ŒæˆðŸŽ€
