# 11.2 å‡½æ•°å‚æ•°åŒ–

![](../img/11.2.jpg)

## ä½¿ç”¨åœºæ™¯

- å¦‚æœæœ‰ä¸¤ä¸ªå‡½æ•°é€»è¾‘ç›¸ä¼¼ï¼Œåªæœ‰ä¸€äº›å­—é¢é‡å€¼ä¸åŒï¼Œå¯ä»¥å°†å…¶åˆå¹¶æˆä¸€ä¸ªå‡½æ•°ï¼Œä»¥å‚æ•°çš„å½¢å¼ä¼ å…¥ä¸åŒçš„å€¼ï¼Œä»è€Œæ¶ˆé™¤é‡å¤ã€‚

## ç¤ºä¾‹ 1. ä¸€ä¸ªç®€å•çš„ä¾‹å­

### é‡æ„å‰

```java
function tenPercentRaise(aPerson)
{
    aPerson.salary = aPerson.salary.multiply(1.1);
}
function fivePercentRaise(aPerson)
{
    aPerson.salary = aPerson.salary.multiply(1.05);
}
```

### é‡æ„å

```java
function raise(aPerson, factor)
{
    aPerson.salary = aPerson.salary.multiply(1 + factor);
}
```

## ç¤ºä¾‹ 2. ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­

### é‡æ„å‰

```java
function baseCharge(usage)
{
    if (usage < 0) return usd(0);
    const amount =
            bottomBand(usage) * 0.03
            + middleBand(usage) * 0.05
            + topBand(usage) * 0.07;
    return usd(amount);
}
function bottomBand(usage)
{
    return Math.min(usage, 100);
}
function middleBand(usage)
{
    return usage > 100 ? Math.min(usage, 200) - 100 : 0;
}
function topBand(usage)
{
    return usage > 200 ? usage - 200 : 0;
}
```

### STEP1. ä»ä¸€ç»„ç›¸ä¼¼çš„å‡½æ•°ä¸­é€‰æ‹©ä¸€ä¸ª

- ç±»ä¼¼è¿™æ ·å¤„ç†èŒƒå›´çš„æƒ…å†µï¼Œé€šå¸¸ä»ä½äºä¸­é—´çš„èŒƒå›´å¼€å§‹ç€å®æ¯”è¾ƒå¥½

```java
function middleBand(usage)
{
    return usage > 100 ? Math.min(usage, 200) - 100 : 0;
}
```

### STEP2. è¿ç”¨ [6.5 æ”¹å˜å‡½æ•°å£°æ˜](../Chapter_6/6.5_change_function_declaration.md)ï¼Œ æŠŠéœ€è¦ä½œä¸ºå‚æ•°ä¼ å…¥çš„å­—é¢é‡æ·»åŠ åˆ°å‚æ•°åˆ—è¡¨ä¸­

```java
function /*middleBand*/withinBand(usage, bottom, top)
{
    return usage > 100 ? Math.min(usage, 200) - 100 : 0;
}
function baseCharge(usage)
{
    if (usage < 0) return usd(0);
    const amount =
            bottomBand(usage) * 0.03
            + withinBand(usage, 100, 200) * 0.05
            + topBand(usage) * 0.07;
    return usd(amount);
}
```

- åœ¨å‡½æ•°ä½“å†…éƒ¨ï¼ŒæŠŠä¸€ä¸ªå­—é¢é‡æ”¹ä¸ºä½¿ç”¨æ–°ä¼ å…¥çš„å‚æ•°

```java
function withinBand(usage, bottom, top)
{
    return usage > bottom ? Math.min(usage, top) - bottom : 0;
}
```

### STEP3. ä¿®æ”¹è¯¥å‡½æ•°æ‰€æœ‰çš„è°ƒç”¨å¤„ï¼Œä½¿å…¶åœ¨è°ƒç”¨æ—¶ä¼ å…¥è¯¥å­—é¢é‡å€¼

- å°†åŸæœ¬è°ƒç”¨ `bottomBand` å‡½æ•°çš„åœ°æ–¹ï¼Œå°†å…¶æ”¹ä¸ºè°ƒç”¨å‚æ•°åŒ–äº†çš„æ–°å‡½æ•°

```java
function baseCharge(usage)
{
    if (usage < 0) return usd(0);
    const amount =
            /*bottomBand(usage) * 0.03*/
            withinBand(usage, 0, 100) * 0.03
            + withinBand(usage, 100, 200) * 0.05
            + topBand(usage) * 0.07;
    return usd(amount);
}
// function bottomBand(usage)
// {
//     return Math.min(usage, 100);
// }
```

- æ›¿æ¢å¯¹ `topBand` çš„è°ƒç”¨ï¼Œç”¨ä»£è¡¨â€œæ— ç©·å¤§â€çš„ `Infinity` ä½œä¸ºè¿™ä¸ªèŒƒå›´çš„ä¸Šç•Œ

```java
function baseCharge(usage)
{
    if (usage < 0) return usd(0);
    const amount =
            withinBand(usage, 0, 100) * 0.03
            + withinBand(usage, 100, 200) * 0.05
            + withinBand(usage, 200, Infinity) * 0.07;
            /*+ topBand(usage) * 0.07*/;
    return usd(amount);
}
// function topBand(usage)
// {
//     return usage > 200 ? usage - 200 : 0;
// }
```

### é‡æ„å

```java
function withinBand(usage, bottom, top)
{
    return usage > bottom ? Math.min(usage, top) - bottom : 0;
}
function baseCharge(usage)
{
    if (usage < 0) return usd(0);
    const amount =
            withinBand(usage, 0, 100) * 0.03
            + withinBand(usage, 100, 200) * 0.05
            + withinBand(usage, 200, Infinity) * 0.07;
            /*+ topBand(usage) * 0.07*/;
    return usd(amount);
}
```

## é‡æ„å®ŒæˆğŸ€
