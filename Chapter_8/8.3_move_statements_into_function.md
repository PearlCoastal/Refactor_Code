# 8.3 æ¬ç§»è¯­å¥åˆ°å‡½æ•°

## ä½¿ç”¨åœºæ™¯

- æ¶ˆé™¤é‡å¤ï¼Œå¦‚æœå†è°ƒç”¨æŸä¸ªå‡½æ•°æ—¶ï¼Œæ€»æœ‰ä¸€äº›ç›¸åŒçš„ä»£ç ä¹Ÿéœ€è¦æ¯æ¬¡æ‰§è¡Œï¼Œè€ƒè™‘å°†æ­¤æ®µä»£ç åˆå¹¶åˆ°å‡½æ•°é‡Œ

- @Date: 2023-04-24 10:47:42

> [åå‘é‡æ„ï¼š8.4 æ¬ç§»è¯­å¥åˆ°è°ƒç”¨è€…](./8.4_move_statements_to_callers.md)

### é‡æ„å‰

- emitPhotoDataçš„ä¸¤ä¸ªè°ƒç”¨ç‚¹å‰ï¼Œéƒ½æœ‰ä¸€è¡Œç±»ä¼¼çš„é‡å¤ä»£ç ï¼Œç”¨äºæ‰“å°ä¸titleç›¸å…³çš„ä¿¡æ¯ï¼Œè€ƒè™‘å°†è¿™è¡Œä»£ç ç§»åˆ°emitPhotoDataä¸­

```java
function renderPerson(outStream, person)
{
    const result = [];
    result.push(`<p> ${person.name}</ p>`);
    result.push(renderPhoto(person.photo));
    result.push(`<p> title
                : ${person.photo.title}</ p>`);
    result.push(emitPhotoData(person.photo));
    return result.join("\n");
}
function photoDiv(p)
{
    return [
        "<div>",
`<p> title:${p.title}</ p>`,
            emitPhotoData(p),
            "</div>",
    ]
        .join("\n");
}
function emitPhotoData(aPhoto)
{
    const result = [];
    result.push(`<p> location
                : ${aPhoto.location}</ p>`);
    result.push(`<p> date
                : ${aPhoto.date.toDateString()}</ p>`);
    return result.join("\n");
}
```

### STEP1. å…ˆé€‰æ‹©å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ç‚¹ photoDivï¼Œå¯¹é½æç‚¼å‡½æ•°

```java
function photoDiv(p)
{
    return [
        "<div>",
        zznew(p),
        "</div>",
    ]
        .join("\n");
}
function zznew(p)
{
    return [
`<p> title:${p.title}</ p>`,
               emitPhotoData(p),
    ]
        .join("\n");
}
```

### STEP2. æ‰¾åˆ°å…¶ä»–çš„è°ƒç”¨ç‚¹ï¼Œä¸€å¹¶æ¢æˆå¯¹æ–°å‡½æ•°çš„è°ƒç”¨

```java
function renderPerson(outStream, person)
{
    const result = [];
    result.push(`<p> ${person.name}</ p>`);
    result.push(renderPhoto(person.photo));
    // NOTE:
    result.push(zznew(person.photo));
    return result.join("\n");
}
```

### STEP3. æ›¿æ¢æ‰€æœ‰è°ƒç”¨ç‚¹ä¹‹åï¼Œåº”ç”¨å†…è”å‡½æ•°å°†emitPhotoDataå‡½æ•°å†…è”åˆ°æ–°å‡½æ•°ä¸­

```java
function zznew(p)
{
    return [
`<p> title:${p.title}</ p>`,
`<p> location:${p.location}</ p>`,
`<p> date:${p.date.toDateString()}</ p>`,
    ]
        .join("\n");
}
```

### STEP4. å¯¹æ–°æç‚¼çš„å‡½æ•°åº”ç”¨å‡½æ•°æ”¹å

```java
function renderPerson(outStream, person)
{
    const result = [];
    result.push(`<p> ${person.name}</ p>`);
    result.push(renderPhoto(person.photo));
    result.push(emitPhotoData(person.photo));
    return result.join("\n");
}
function photoDiv(aPhoto)
{
    return [
        "<div>",
        emitPhotoData(aPhoto),
        "</div>",
    ]
        .join("\n");
}
function emitPhotoData(aPhoto)
{
    return [
`<p> title:${aPhoto.title}</ p>`,
`<p> location:${aPhoto.location}</ p>`,
`<p> date:${aPhoto.date.toDateString()}</ p>`,
    ]
        .join("\n");
}
```

### é‡æ„å®ŒæˆğŸ€
