
# 8.1 æ¬ç§»ä»£ç 

## ä½¿ç”¨åœºæ™¯ å¥½çš„æ¨¡å—åŒ– -> è®©å‡½æ•°å»åˆ°ä»–çš„ä¸Šä¸‹æ–‡

* @Date: 2023-04-23 14:15:32

> [1. æ¬ç§»å†…åµŒå‡½æ•°è‡³é¡¶å±‚]()
>
> [2. åœ¨ç±»ä¹‹é—´æ¬ç§»å‡½æ•°]()

## 1. æ¬ç§»å†…åµŒå‡½æ•°è‡³é¡¶å±‚

### é‡æ„å‰

* æ¬ç§» calculateDistance å‡½æ•°åˆ°é¡¶å±‚ï¼Œè¿™æ ·å¯ä»¥å•ç‹¬è®¡ç®—è½¨è¿¹çš„è·ç¦»ï¼Œä¸å¿…ç®—å‡ºsummaryçš„å…¶ä»–éƒ¨åˆ†

```java
function trackSummary(points)
{
    const totalTime = calculateTime();
    const totalDistance = calculateDistance();
    const pace = totalTime / 60 / totalDistance;
    return {
        time : totalTime,
        distance : totalDistance,
        pace : pace
    };
    function calculateDistance()
    {
        let result = 0;
        for (let i = 1; i < points.length; i++)
        {
            result += distance(points[i - 1], points[i]);
        }
        return result;
    }
    function distance(p1, p2){...} function radians(degrees){...} function calculateTime() { ... }
}
```

### STEP1. å…ˆå¤åˆ¶ä¸€ä»½åˆ°é¡¶å±‚ä½œç”¨åŸŸä¸­

```java
function trackSummary(points)
{
    const totalTime = calculateTime();
    const totalDistance = calculateDistance();
    const pace = totalTime / 60 / totalDistance;
    return {
        time : totalTime,
        distance : totalDistance,
        pace : pace
    };
    function calculateDistance()
    {
        let result = 0;
        for (let i = 1; i < points.length; i++)
        {
            result += distance(points[i - 1], points[i]);
        }
        return result;
    }
    ... function distance(p1, p2){...} function radians(degrees){...} function calculateTime() { ... }
}
function top_calculateDistance()
{
    let result = 0;
    for (let i = 1; i < points.length; i++)
    {
        result += distance(points[i - 1], points[i]);
    }
    return result;
}
```

#### top_calculateDistanceä¸­çš„pointså¯ä»¥ä½œä¸ºå‚æ•°ä¼ è¿›æ¥, distanceè€ƒè™‘ä¸€èµ·æ¬å‡ºæ¥

```java
function trackSummary(points)
{
    function distance(p1, p2)
    {
        const EARTH_RADIUS = 3959; // in miles
        const dLat = radians(p2.lat) - radians(p1.lat);
        const dLon = radians(p2.lon) - radians(p1.lon);
        const a = Math.pow(Math.sin(dLat / 2), 2) + Math.cos(radians(p2.lat)) * Math.cos(radians(p1.lat)) * Math.pow(Math.sin(dLon / 2), 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return EARTH_RADIUS * c;
    }
    function radians(degrees)
    {
        return degrees * Math.PI / 180;
    }
}
```

### STEP2. å°†æ¶‰åŠåˆ°çš„ distance å‡½æ•°ä¹Ÿä¸€å¹¶æ¬åˆ°å¤–é¢

```java
function trackSummary(points)
{
    const totalTime = calculateTime();
    const totalDistance = calculateDistance();
    const pace = totalTime / 60 / totalDistance;
    return {
        time : totalTime,
        distance : totalDistance,
        pace : pace
    };
    function calculateDistance()
    {
        let result = 0;
        for (let i = 1; i < points.length; i++)
        {
            result += distance(points[i - 1], points[i]);
        }
        return result;
        function distance(p1, p2){...} function radians(degrees) { ... }
    }
}

function top_calculateDistance(points)
{
    let result = 0;
    for (let i = 1; i < points.length; i++)
    {
        result += distance(points[i - 1], points[i]);
    }
    return result;
    function distance(p1, p2){...} function radians(degrees) { ... }
}
```

### STEP3. åœ¨åŸå‡½æ•°ä½“å†…è°ƒç”¨é¡¶å±‚ä½œç”¨åŸŸå¤åˆ¶å‡½æ•°

```java
function trackSummary(points)
{
    const totalTime = calculateTime();
    const totalDistance = calculateDistance();
    const pace = totalTime / 60 / totalDistance;
    return {
        time : totalTime,
        distance : totalDistance,
        pace : pace
    };
    function calculateDistance()
    {
         // NOTE
        return top_calculateDistance(points);
    }
}
```

### STEP4. åŸå‡½æ•°çš„è°ƒç”¨ç‚¹ä¸å¤šï¼Œç›´æ¥ç§»é™¤åŸå‡½æ•°

```java
function trackSummary(points)
{
    const totalTime = calculateTime();
    const pace = totalTime / 60 / totalDistance(points);
    return {
        time : totalTime,
        distance : totalDistance(points),
        pace : pace
    };
}
function totalDistance(points)
{
    let result = 0;
    for (let i = 1; i < points.length; i++)
    {
        result += distance(points[i - 1], points[i]);
    }
    return result;
}
```

### é‡æ„å

```java
function trackSummary(points){...} function totalDistance(points){...} function distance(p1, p2){...} function radians(degrees) { ... }
```

## 2. åœ¨ç±»ä¹‹é—´æ¬ç§»å‡½æ•°

* overdraftChargeä¼šæ ¹æ®typeè®¡ç®—é€æ”¯é‡‘é¢
* è€ƒè™‘å°†overdraftChargeå‡½æ•°ä½“æ¬åˆ°AccountTypeç±»ä¸­

```java
class Account
{
    get bankCharge()
    {
        let result = 4.5;
        if (this._daysOverdrawn > 0)
            result += this.overdraftCharge;
        return result;
    }
    get overdraftCharge()
    {
        if (this.type.isPremium)
        {
            const baseCharge = 10;
            if (this.daysOverdrawn <= 7)
                return baseCharge;
            else
return baseCharge + (this.daysOverdrawn - 7)* 0.85;
        }
        else
            return this.daysOverdrawn * 1.75;
    }
}
```

### STEP1. å¤åˆ¶ overdraftChargeåˆ°AccountTypeç±»ä¸­

```java
class AccountType
{
    overdraftCharge(daysOverdrawn)
    {
        if (this.isPremium)
        {
            const baseCharge = 10;
            if (daysOverdrawn <= 7)
                return baseCharge;
            else
return baseCharge + (daysOverdrawn - 7)* 0.85;
        }
        else
            return daysOverdrawn * 1.75;
    }
}

// åŸæ¥çš„æ–¹æ³•ç”¨å§”æ‰˜è°ƒç”¨æ›¿ä»£
class Account
{
    get bankCharge()
    {
        let result = 4.5;
        if (this._daysOverdrawn > 0)
            result += this.overdraftCharge;
        return result;
    }
    get overdraftCharge()
    {
         // NOTE
        return this.type.overdraftCharge(this.daysOverdrawn);
    }
}
```

### STEP2. ä¿ç•™å§”æ‰˜å‡½æ•° or ç›´æ¥å†…è”

```java
// å†…è”
class Account
{
    get bankCharge()
    {
        let result = 4.5;
         // NOTE:
        if (this._daysOverdrawn > 0)
            result += this.type.overdraftCharge(this.daysOverdrawn);
        return result;
    }
}

// ç›´æ¥å°†æ•´ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’
class Account
{
    get bankCharge()
    {
        let result = 4.5;
        if (this._daysOverdrawn > 0)
            result += this.overdraftCharge;
        return result;
    }
    get overdraftCharge()
    {
         // NOTE
        return this.type.overdraftCharge(this);
    }
}

class AccountType
{
    overdraftCharge(account)
    {
        if (this.isPremium)
        {
            const baseCharge = 10;
            if (account.daysOverdrawn <= 7)
                return baseCharge;
            else
                return baseCharge + (account.daysOverdrawn - 7) *0.85;
        }
        else
return account.daysOverdrawn* 1.75;
    }
}
```

### é‡æ„å®ŒæˆğŸ€
