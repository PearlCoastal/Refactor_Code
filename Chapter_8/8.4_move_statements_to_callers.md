# 8.4 æ¬ç§»è¯­å¥åˆ°è°ƒç”¨è€…

## ä½¿ç”¨åœºæ™¯
-  å½“ä¸€ä¸ªå‡½æ•°åˆ†åŒ–å‡ºä¸¤ä¸ªæˆ–å¤šä¸ªè°ƒç”¨ç‚¹å‰çš„ä¸åŒè¡Œä¸ºï¼Œå°†ä¸åŒçš„è¡Œä¸ºæ¬ç§»åˆ°è°ƒç”¨ç‚¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æœ¬é‡æ„æ‰‹æ³•ã€‚
- ä½†æ˜¯å½“è°ƒç”¨ç‚¹å’Œè°ƒç”¨è€…å·²ç»æƒ³å»ç”šè¿œçš„æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„æ–¹æ³•æ—¶å…ˆä½¿ç”¨å†…è”å‡½æ•°ï¼Œåˆå¹¶åŒæ–¹çš„å†…å®¹ï¼Œè°ƒæ•´è¯­åºï¼Œå†æç‚¼é™¤æ–°çš„å‡½æ•°ï¼Œä»¥å½¢æˆæ›´åˆé€‚çš„è¾¹ç•Œã€‚
 * @Date: 2023-04-24 11:14:07

> [åå‘é‡æ„ï¼š8.3 æ¬ç§»è¯­å¥åˆ°å‡½æ•°](Chapter_8/8.3_move_statements_into_function.md)


### é‡æ„å‰

- æ”¯æŒlistRecentPhotoså‡½æ•°ä»¥ä¸åŒæ–¹å¼æ¸²æŸ“ç›¸ç‰‡çš„locationä¿¡æ¯
- ä¿æŒrenderPersonçš„è¡Œä¸ºä¸å˜
- å°†emitPhotoDataå‡½æ•°æœ€åä¸€è¡Œçš„ä»£ç æ¬ç§»åˆ°å…¶è°ƒç”¨ç«¯

```java
function renderPerson(outStream, person)
{
    outStream.write(`<p> ${person.name}</ p>\n`);
    renderPhoto(outStream, person.photo);
    emitPhotoData(outStream, person.photo);
}
function listRecentPhotos(outStream, photos)
{
    photos
        .filter(p = > p.date > recentDateCutoff())
        .forEach(p = > {
            outStream.write("<div>\n");
            emitPhotoData(outStream, p);
            outStream.write("</div>\n");
        });
}
function emitPhotoData(outStream, photo)
{
    outStream.write(`<p> title
                    : ${photo.title}</ p>\n`);
    outStream.write(`<p> date
                    : ${photo.date.toDateString()}</ p>\n`);
    outStream.write(`<p> location
                    : ${photo.location}</ p>\n`);
}
```

### STEP1. æç‚¼çš„ç¬¬ä¸€æ­¥ï¼Œå…ˆç”¨æç‚¼å‡½æ•°ï¼Œå°†å“ªäº›æœ€ç»ˆå¸Œæœ›ç•™åœ¨emitPhotoDataå‡½æ•°é‡Œçš„è¯­å¥å…ˆæç‚¼å‡ºå»

```java
function renderPerson(outStream, person)
{
    outStream.write(`<p> ${person.name}</ p>\n`);
    renderPhoto(outStream, person.photo);
    emitPhotoData(outStream, person.photo);
}
function listRecentPhotos(outStream, photos)
{
    photos
        .filter(p = > p.date > recentDateCutoff())
        .forEach(p = > {
            outStream.write("<div>\n");
            emitPhotoData(outStream, p);
            outStream.write("</div>\n");
        });
}
function emitPhotoData(outStream, photo)
{
    zztmp(outStream, photo);
    // NOTE: ç•™ä¸‹æœ€åä¸€è¡Œä»£ç 
    outStream.write(`<p> location
                    : ${photo.location}</ p>\n`);
}
function zztmp(outStream, photo)
{
    outStream.write(`<p> title
                    : ${photo.title}</ p>\n`);
    outStream.write(`<p> date
                    : ${photo.date.toDateString()}</ p>\n`);
}
```

### STEP2. å¯¹emitPhotoDataçš„è°ƒç”¨ç‚¹æ³¨æ„åº”ç”¨å†…è”å‡½æ•°

```java
function renderPerson(outStream, person)
{
    outStream.write(`<p> ${person.name}</ p>\n`);
    renderPhoto(outStream, person.photo);
    // NOTE: ç¬¬ä¸€ä¸ªè°ƒç”¨ç‚¹
    zztmp(outStream, person.photo);
    outStream.write(`<p> location
                    : ${person.photo.location}</ p>\n`);
}
function listRecentPhotos(outStream, photos)
{
    photos
        .filter(p = > p.date > recentDateCutoff())
        .forEach(p = > {
            outStream.write("<div>\n");
            // NOTE: ç¬¬äºŒä¸ªè°ƒç”¨ç‚¹
            zztmp(outStream, p);
            outStream.write(`<p> location
                            : ${p.location}</ p>\n`);
            outStream.write("</div>\n");
        });
}
function emitPhotoData(outStream, photo)
{
    zztmp(outStream, photo);
    outStream.write(`<p> location
                    : ${photo.location}</ p>\n`);
}
function zztmp(outStream, photo)
{
    outStream.write(`<p> title
                    : ${photo.title}</ p>\n`);
    outStream.write(`<p> date
                    : ${photo.date.toDateString()}</ p>\n`);
}
```

### STEP3. ç§»é™¤å¤–é¢çš„emitPhotoDataå‡½æ•°ï¼Œå®Œæˆå†…è”æ‰‹æ³•

```java
function renderPerson(outStream, person)
{
    outStream.write(`<p> ${person.name}</ p>\n`);
    renderPhoto(outStream, person.photo);
    zztmp(outStream, person.photo);
    outStream.write(`<p> location
                    : ${person.photo.location}</ p>\n`);
}
function listRecentPhotos(outStream, photos)
{
    photos
        .filter(p = > p.date > recentDateCutoff())
        .forEach(p = > {
            outStream.write("<div>\n");
            zztmp(outStream, p);
            outStream.write(`<p> location
                            : ${p.location}</ p>\n`);
            outStream.write("</div>\n");
        });
}
// function emitPhotoData(outStream, photo)
// {
//     zztmp(outStream, photo);
//     outStream.write(`<p> location
//                     : ${photo.location}</ p>\n`);
// }
function zztmp(outStream, photo)
{
    outStream.write(`<p> title
                    : ${photo.title}</ p>\n`);
    outStream.write(`<p> date
                    : ${photo.date.toDateString()}</ p>\n`);
}
```

### STEP4. å°†æ–°å‡½æ•°å‘½åä¸º emitPhotoData

```java
function renderPerson(outStream, person)
{
    outStream.write(`<p> ${person.name}</ p>\n`);
    renderPhoto(outStream, person.photo);
    emitPhotoData(outStream, person.photo);
    outStream.write(`<p> location
                    : ${person.photo.location}</ p>\n`);
}
function listRecentPhotos(outStream, photos)
{
    photos
        .filter(p = > p.date > recentDateCutoff())
        .forEach(p = > {
            outStream.write("<div>\n");
            emitPhotoData(outStream, p);
            outStream.write(`<p> location
                            : ${p.location}</ p>\n`);
            outStream.write("</div>\n");
        });
}
function emitPhotoData(outStream, photo)
{
    outStream.write(`<p> title
                    : ${photo.title}</ p>\n`);
    outStream.write(`<p> date
                    : ${photo.date.toDateString()}</ p>\n`);
}
```

### å®Œæˆé‡æ„ ğŸ€